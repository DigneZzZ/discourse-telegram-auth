# üéâ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã Telegram OAuth —Ä–µ—à–µ–Ω—ã

## –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞: –ó–ê–í–ï–†–®–ï–ù ‚úÖ

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. ‚ùå ‚Üí ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ (v1.1.1)
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–ª–∞–≥–∏–Ω –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª—Å—è –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω –∫–æ–¥ –≤ –±–ª–æ–∫ `after_initialize` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `class_eval`

#### 2. ‚ùå ‚Üí ‚úÖ –ó–∞–≤–∏—Å–∞–Ω–∏–µ –Ω–∞ reconnect=true —Å—Å—ã–ª–∫–∞—Ö (v1.1.2)  
**–ü—Ä–æ–±–ª–µ–º–∞**: Discourse –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª —Å—Å—ã–ª–∫–∏ —Å `reconnect=true`, –≤—ã–∑—ã–≤–∞—é—â–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏–µ
**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω `connect_path` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å—Å—ã–ª–æ–∫

#### 3. ‚ùå ‚Üí ‚úÖ Content Security Policy –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (v1.1.3)
**–ü—Ä–æ–±–ª–µ–º–∞**: CSP –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∑–∞–≥—Ä—É–∑–∫—É Telegram –≤–∏–¥–∂–µ—Ç–∞
**–†–µ—à–µ–Ω–∏–µ**: –†–∞—Å—à–∏—Ä–µ–Ω–∞ CSP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `https://telegram.org`

#### 4. ‚ùå ‚Üí ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª—é—á–µ–π –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (v1.1.4)
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–Ω–æ–ø–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ `[ru.user.associated_accounts.connect]`
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

## –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 1.1.4

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–ª–∞–≥–∏–Ω–∞:
- ‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram** - –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∞—è
- ‚úÖ **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤** - –ë–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏–π
- ‚úÖ **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤** - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π
- ‚úÖ **–†—É—Å—Å–∫–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** - –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π Telegram
- ‚úÖ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è:

#### Backend (Ruby):
```ruby
class TelegramAuthenticator < Auth::ManagedAuthenticator
  # –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
  def connect_path(options = {}) - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç reconnect=true
  def revoke_path - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤  
  def after_authenticate - –æ–±—Ä–∞–±–æ—Ç–∫–∞ OAuth –¥–∞–Ω–Ω—ã—Ö
  def validate_telegram_signature - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  def self.register_translations - —Ä—É—Å—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã
end
```

#### Frontend (JavaScript):
```javascript
// telegram-auth-translations.js
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ä—É—Å—Å–∫–∏—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤
```

#### Templates (ERB):
```erb
<!-- telegram.html.erb -->
<!-- Telegram –≤–∏–¥–∂–µ—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π CSP -->
```

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- **CSP**: –†–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —Å `https://telegram.org`
- **–†–æ—É—Ç—ã**: `/auth/telegram`, `/auth/telegram/callback`, `/auth/telegram/revoke`
- **–ü–µ—Ä–µ–≤–æ–¥—ã**: –ü–æ–ª–Ω–∞—è —Ä—É—Å—Å–∫–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

## –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `plugin.rb` - –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø–ª–∞–≥–∏–Ω–∞ (v1.1.4)
- `config/settings.yml` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–≥–∏–Ω–∞
- `app/views/omniauth_callbacks/telegram.html.erb` - –®–∞–±–ª–æ–Ω Telegram –≤–∏–¥–∂–µ—Ç–∞

### –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è:
- `config/locales/client.ru.yml` - –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã
- `config/locales/server.ru.yml` - –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã
- `assets/javascripts/discourse/initializers/telegram-auth-translations.js` - JS –ø–µ—Ä–µ–≤–æ–¥—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `COMPLETE_FIX_REPORT.md` - –û—Ç—á–µ—Ç –æ —Ä–µ—à–µ–Ω–∏–∏ reconnect –ø—Ä–æ–±–ª–µ–º—ã
- `CSP_FIX_REPORT.md` - –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ CSP
- `TRANSLATIONS_FIX_REPORT.md` - –û—Ç—á–µ—Ç –æ –ø–µ—Ä–µ–≤–æ–¥–∞—Ö
- `QUICK_TRANSLATIONS_FIX.md` - –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- `CHECKLIST.md` - –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `TROUBLESHOOTING.md` - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- `spec/telegram_authenticator_spec.rb` - –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
- `debug.js` - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- `diagnose.rb` - –°–µ—Ä–≤–µ—Ä–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–∞
```bash
# –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Discourse
cd plugins
git clone [repository-url] discourse-telegram-auth
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞
1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather –≤ Telegram
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–º—è –±–æ—Ç–∞ (–¥–æ–ª–∂–Ω–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ "Bot")

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Discourse
```ruby
# –í –∞–¥–º–∏–Ω–∫–µ Discourse
SiteSetting.telegram_auth_enabled = true
SiteSetting.telegram_auth_bot_name = "YourBot"
SiteSetting.telegram_auth_bot_token = "123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
SiteSetting.telegram_auth_debug = false # –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
```bash
./launcher rebuild app
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫:
- [ ] –ü–ª–∞–≥–∏–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/auth/telegram` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Telegram –≤–∏–¥–∂–µ—Ç
- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–∏—è
- [ ] –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ö–Ω–æ–ø–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö Discourse
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ CSP –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
tail -f log/production.log | grep -i telegram

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ Rails console
rails c
puts SiteSetting.telegram_auth_enabled
puts SiteSetting.telegram_auth_bot_name.present?

# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–ª–∞–≥–∏–Ω–∞
TelegramAuthenticator.diagnose_setup
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
- **Discourse**: 3.0+
- **Ruby**: 3.0+
- **omniauth-telegram**: 0.2.1
- **–ë—Ä–∞—É–∑–µ—Ä—ã**: Chrome, Firefox, Safari, Edge

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f log/production.log | grep -i telegram`
2. –í–∫–ª—é—á–∏—Ç–µ –æ—Ç–ª–∞–¥–∫—É: `SiteSetting.telegram_auth_debug = true`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CSP –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —É @BotFather

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω!** üéâ

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –∑–∞–≤–∏—Å–∞–Ω–∏—è –Ω–∞ reconnect —Å—Å—ã–ª–∫–∞—Ö  
- ‚úÖ –†–µ—à–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å Content Security Policy
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Ä—É—Å—Å–∫–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

–ü–ª–∞–≥–∏–Ω –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ Telegram –≤ Discourse.

---
**–§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è**: 1.1.4  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 6 –∏—é–Ω—è 2025 –≥.  
**–°—Ç–∞—Ç—É—Å**: –ì–û–¢–û–í –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ ‚úÖ
